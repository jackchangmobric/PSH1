<div data-page='new-device' class='page no-navbar no-toolbar'>
    <style>
    input[data-empty] {
        background: #ffb0b0 !important;
    }
    </style>
    <script>
$page.onload(function(e) {
    var mac = e.query.mac;
    if (!mac) {
        $(e.container, 'input#mac').readOnly = false;
        return;
    }

    var info = $db.devices[mac];
    if (!info) {
        return;
    }

    $(e.container, 'input#mac').value = mac;
    Object.keys(info).forEach(function(k) {
        var input = $(e.container, 'input#' + k);
        if (input) {
            input.value = info[k];
        }
    });
});

$page.onload(function(e) {
    $('#done').onclick = function() {
        var mac = $(e.container, 'input#mac').value;
        if (!mac) {
            return $mainView.router.loadPage('pages/device-list.html');
        }

        (($db.devices[mac]) ? Promise.resolve() : $gateway.add(mac))
            .then(function() {
                $db.devices.$update(function(db) {
                    var info = db[mac];
                    if (!info && e.query.mac) {
                        return;
                    }

                    if (!info) { info = db[mac] = {}; }
                    $(e.container, 'input', true).forEach(function(i) {
                        if (i.id === 'mac') { return; }
                        info[i.id] = i.value;
                    });
                }).$save().then(function() {
                    $mainView.router.loadPage('pages/device-list.html');
                });
            })
            .catch(function(e) {
                $app.alert(e, '', function() {
                    $mainView.router.loadPage('pages/device-list.html');                    
                });
            });
    };

    // /add_dev_by_mac

});

    </script>

    <div class="navbar">
        <div class="navbar-inner">
            <div class='left'></div>
            <div class="center" id='device-mac'></div>
            <div class='right'></div>
        </div>
    </div>
    <div class='page-content'>
        <div class='strings'>
        </div>

        <div class="content-block-title" data-i18n-key='basic-information'></div>
        <div class='list-block' id='basic-information'><form>
            <ul>
                <li><div class='item-content'>
                    <div class='item-media'><i class='icon f7-icons'>info</i></div>
                    <div class='item-inner'>
                        <div class='item-title label' data-i18n-key='name'></div>
                        <div class='item-input'>
                            <input type='text' id='name' data-i18n-key='empty-name:placeholder'>
                        </div>
                    </div>
                </div></li>

                <li><div class='item-content'>
                    <div class='item-media'><i class='icon f7-icons'>radio</i></div>
                    <div class='item-inner'>
                        <div class='item-title label' data-i18n-key='mac'></div>
                        <div class='item-input'>
                            <input type='text' id='mac' readonly>
                        </div>
                    </div>
                </div></li>
                <li><div class='item-content'>
                    <div class='item-media'><i class='icon f7-icons'>radio</i></div>
                    <div class='item-inner'>
                        <div class='item-title label' data-i18n-key='type'></div>
                        <div class='item-input'>
                            <input type='text' id='type' readonly>
                        </div>
                    </div>
                </div></li>
            </ul>
        </form></div>

        <div class="content-block-title" data-i18n-key='location-information'></div>
        <div class='list-block' id='location-information'><form>
            <ul>
                <li><div class='item-content'>
                    <div class='item-media'><i class='icon f7-icons'>info</i></div>
                    <div class='item-inner'>
                        <div class='item-title label' data-i18n-key='room'></div>
                        <div class='item-input'>
                            <input type='text' id='room' readonly>
                        </div>
                    </div>
                </div></li>
                <li><div class='item-content'>
                    <div class='item-media'><i class='icon f7-icons'>info</i></div>
                    <div class='item-inner'>
                        <div class='item-title label' data-i18n-key='pos-x'></div>
                        <div class='item-input'>
                            <input type='text' id='x' readonly>
                        </div>
                    </div>
                </div></li>
                <li><div class='item-content'>
                    <div class='item-media'><i class='icon f7-icons'>info</i></div>
                    <div class='item-inner'>
                        <div class='item-title label' data-i18n-key='pos-y'></div>
                        <div class='item-input'>
                            <input type='text' id='y' readonly>
                        </div>
                    </div>
                </div></li>
            </ul>
        </form></div>

        <div class='content-block'>
            <p class="buttons-row">
                <a href="#" id='cancel' class="button button-raised link back" data-i18n-key='cancel'></a>
            </p>
            <p class="buttons-row">
                <a href="#" id='done' class="button button-fill button-raised link" data-i18n-key='done'></a>
            </p>
        </div>
    </div>
</div>